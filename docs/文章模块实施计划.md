# 文章（Articles）模块实施计划

## 一、技术方案选型

### 推荐方案：Velite

经过对 2025-2026 年主流 Markdown 博客方案的深度调研，推荐使用 **Velite** 作为内容管理方案。

#### 方案对比总结

| 方案 | Next.js 15 兼容 | 类型安全 | 维护状态 | 推荐度 |
|------|----------------|---------|---------|-------|
| **Velite** | 完全兼容 | Zod schema，最佳 | 积极维护 | **推荐** |
| @next/mdx | 兼容 | 弱 | 官方维护 | 不适合博客场景 |
| next-mdx-remote | RSC 已知 bug | 中等 | 缓慢 | 不推荐 |
| Contentlayer2 | 基本兼容 | 好 | 社区 fork，不稳定 | 不推荐 |
| 自定义 gray-matter | 兼容 | 手动 | N/A | 维护成本高 |

#### 选择 Velite 的理由

1. **Contentlayer 的真正继承者**：API 设计高度相似，但积极维护中
2. **类型安全**：基于 Zod schema，frontmatter 全程类型推断，编译时捕获错误
3. **SSG 完美适配**：构建时处理所有内容，运行时零开销
4. **i18n 友好**：schema 中定义 locale 字段 + 目录分层，与项目现有双语体系一致
5. **图片自动处理**：Markdown 中引用的图片自动复制到 `/public/static/`
6. **开发体验好**：watch 模式下文件变更自动重新生成
7. **Turbopack 兼容**：通过 `next.config.ts` 直接调用 build 方式可绕过 Webpack 插件限制

---

## 二、内容目录结构

```
any_concept_web/
├── content/                          # 新增：内容根目录
│   └── articles/
│       ├── zh/                       # 中文文章
│       │   ├── my-first-article.mdx
│       │   └── design-system-guide.mdx
│       └── en/                       # 英文文章
│           ├── my-first-article.mdx
│           └── design-system-guide.mdx
├── src/
│   ├── app/
│   │   └── articles/                 # 新增：文章路由
│   │       ├── page.tsx              # 文章列表页
│   │       └── [slug]/
│   │           └── page.tsx          # 文章详情页
│   └── ...
├── velite.config.ts                  # 新增：Velite 配置
└── ...
```

### Markdown 文章格式示例

```mdx
---
title: "设计系统的演进之路"
slug: design-system-evolution
date: 2026-02-20
description: "从零搭建一套可扩展的设计系统"
tags:
  - 设计
  - 前端
cover: ./cover.jpg
---

文章正文内容...
```

---

## 三、实施步骤

### 步骤 1：安装依赖与配置 Velite

- 安装 `velite` 包
- 创建 `velite.config.ts`，定义 articles collection 的 Zod schema
- 修改 `next.config.ts` 集成 Velite（Turbopack 兼容写法）
- 配置 `tsconfig.json` 添加 `.velite` 路径别名

### 步骤 2：创建内容目录与示例文章

- 创建 `content/articles/zh/` 和 `content/articles/en/` 目录
- 编写 1-2 篇示例文章（MDX 格式）
- 确认 Velite 构建能正确生成 `.velite/` 输出

### 步骤 3：文章列表页 `/articles`

- 创建 `src/app/articles/page.tsx`
- 从 `.velite` 导入文章数据，按 locale 过滤
- 按日期降序排列
- 实现列表 UI（与现有 Brutalist 暗色风格一致）：
  - 文章标题、日期、标签、摘要
  - 响应式布局
  - Framer Motion 进场动画
- 顶部导航栏（返回按钮 + 语言切换器 + 状态标签）

### 步骤 4：文章详情页 `/articles/[slug]`

- 创建 `src/app/articles/[slug]/page.tsx`
- 实现 `generateStaticParams` 静态生成所有文章路由
- 实现 `generateMetadata` 用于 SEO
- 文章渲染：
  - 标题、日期、标签、封面图
  - MDX/Markdown 内容渲染（支持代码高亮）
  - 上一篇/下一篇导航
- 排版样式（prose typography），适配暗色主题

### 步骤 5：导航集成

- 首页底部导航区新增 `ARTICLES` 入口（编号调整）：

  ```
  01 — CRAFT
  02 — PROJECTS
  03 — ARTICLES（新增）
  04 — CONTACT（保持 mailto）
  ```

- `NavButton.tsx` 菜单新增 ARTICLES 项
- i18n 翻译文件添加 articles 相关词条

### 步骤 6：代码高亮与 MDX 组件（可选增强）

- 集成 `rehype-pretty-code` + `shiki` 实现代码块语法高亮
- 自定义 MDX 组件映射（图片、callout、链接等）
- GFM 支持（表格、任务列表等）

---

## 四、关键技术细节

### Velite 配置示例

```typescript
// velite.config.ts
import { defineConfig, defineCollection, s } from 'velite'
import rehypePrettyCode from 'rehype-pretty-code'

export default defineConfig({
  root: 'content',
  output: {
    data: '.velite',
    assets: 'public/static',
    base: '/static/',
    name: '[name]-[hash:6].[ext]',
    clean: true,
  },
  collections: {
    articles: defineCollection({
      name: 'Article',
      pattern: 'articles/**/*.mdx',
      schema: s
        .object({
          title: s.string().max(120),
          slug: s.slug('articles'),
          date: s.isodate(),
          description: s.string().max(300).optional(),
          tags: s.array(s.string()).default([]),
          cover: s.image().optional(),
          draft: s.boolean().default(false),
          content: s.mdx(),
        })
        .transform((data) => {
          // 从文件路径推断 locale
          return data
        }),
    }),
  },
  mdx: {
    rehypePlugins: [
      [rehypePrettyCode, { theme: 'github-dark' }],
    ],
  },
})
```

### Next.js 配置集成

```typescript
// next.config.ts（Turbopack 兼容写法）
const isDev = process.argv.indexOf('dev') !== -1
const isBuild = process.argv.indexOf('build') !== -1
if (!process.env.VELITE_STARTED && (isDev || isBuild)) {
  process.env.VELITE_STARTED = '1'
  import('velite').then((m) => m.build({ watch: isDev, clean: !isDev }))
}
```

### i18n 集成方式

项目已有自定义 Context API 的 i18n 方案（`useLanguage` hook），文章的多语言通过**文件目录分层**实现：

- `content/articles/zh/xxx.mdx` → 中文文章
- `content/articles/en/xxx.mdx` → 英文文章
- 列表页根据当前 locale 过滤对应语言的文章
- 同一 slug 不同语言的文章自动关联

---

## 五、UI 设计方向

### 列表页风格

延续项目现有 Brutalist 暗色设计系统：

- 背景：`#000000`，文字 `#E8E8E8`
- 文章条目使用列表式布局（类似 Projects 页面的表格风格）
- 每条显示：日期 | 标题 | 标签
- 分隔线使用 `white/10` 风格
- Hover 效果：标题高亮 + 左侧指示器
- 字体：标题 Syne，正文/元信息 JetBrains Mono

### 详情页风格

- 顶部：标题（大字）、日期、标签
- 正文区域：适当限制最大宽度（`max-w-3xl`），暗色 prose 排版
- 代码块：深色主题语法高亮
- 底部：上一篇/下一篇导航

---

## 六、需要安装的依赖

```bash
# 核心
pnpm add velite

# 代码高亮（可选，推荐）
pnpm add rehype-pretty-code shiki

# GFM 支持（可选）
pnpm add remark-gfm
```

---

## 七、.gitignore 更新

```
# Velite 输出
.velite/
```
